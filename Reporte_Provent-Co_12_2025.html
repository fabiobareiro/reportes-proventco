
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Provent-Co | Intelligence Hub</title>
    
    <!-- FUENTES & ICONOS -->
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        :root {
            /* DARK THEME: "OBSIDIAN" */
            --bg-deep: #000000;
            --bg-surface: #0a0a0a;
            --bg-elevated: #111111;
            
            --border: #222222;
            --border-highlight: #333333;
            
            --text-main: #ededed;
            --text-muted: #737373;
            --text-accent: #a3a3a3;

            /* BRAND COLORS */
            --primary: #6366f1; /* Indigo NEON */
            --primary-dim: rgba(99, 102, 241, 0.1);
            --success: #22c55e; /* Green NEON */
            --success-dim: rgba(34, 197, 94, 0.1);
            --warm: #f59e0b;
            
            --font-sans: 'Plus Jakarta Sans', sans-serif;
            --font-mono: 'JetBrains Mono', monospace;
        }

        /* --- BASE --- */
        body { 
            background: var(--bg-deep); color: var(--text-main); font-family: var(--font-sans);
            margin: 0; padding: 0; -webkit-font-smoothing: antialiased;
        }
        * { box-sizing: border-box; }

        /* --- HEADER YTD (ACUMULADO) --- */
        .ytd-header {
            border-bottom: 1px solid var(--border);
            padding: 15px 30px;
            background: rgba(10, 10, 10, 0.8);
            backdrop-filter: blur(10px);
            position: sticky; top: 0; z-index: 100;
            display: flex; justify-content: space-between; align-items: center;
        }
        .logo-block { display: flex; align-items: center; gap: 10px; font-weight: 700; font-size: 1.1rem; letter-spacing: -0.5px; }
        .ytd-stats { display: flex; gap: 30px; }
        .ytd-item { display: flex; flex-direction: column; align-items: flex-end; }
        .ytd-label { font-size: 0.7rem; color: var(--text-muted); text-transform: uppercase; font-weight: 600; letter-spacing: 0.5px; }
        .ytd-val { font-family: var(--font-mono); font-weight: 600; color: var(--text-main); font-size: 0.95rem; }

        /* --- CONTENEDOR PRINCIPAL --- */
        .dashboard-container { max-width: 1400px; margin: 0 auto; padding: 30px; display: grid; grid-template-columns: repeat(12, 1fr); gap: 20px; }

        /* --- CARDS & TITLES --- */
        .card { background: var(--bg-surface); border: 1px solid var(--border); border-radius: 16px; padding: 24px; position: relative; overflow: hidden; display: flex; flex-direction: column; transition: border 0.3s; }
        .card:hover { border-color: var(--border-highlight); }
        .card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .card-title { font-size: 0.9rem; font-weight: 600; color: var(--text-accent); display: flex; align-items: center; gap: 8px; }
        
        /* --- 1. HERO ROI (Big Block) --- */
        .hero-section { grid-column: span 8; background: linear-gradient(145deg, var(--bg-surface), #0e0e11); }
        .roi-display { display: flex; align-items: baseline; gap: 15px; margin-top: 10px; }
        .roi-number { font-family: var(--font-mono); font-size: 4.5rem; font-weight: 700; line-height: 0.9; color: #fff; letter-spacing: -2px; }
        .roi-currency { font-size: 2rem; color: var(--text-muted); }
        .pill { background: var(--bg-elevated); border: 1px solid var(--border); padding: 6px 12px; border-radius: 99px; font-size: 0.8rem; color: var(--text-accent); display: flex; align-items: center; gap: 6px; }
        .pill.active { border-color: var(--primary); color: var(--primary); background: var(--primary-dim); }

        /* --- 2. KPIS COMPARATIVOS --- */
        .kpi-mini { grid-column: span 2; }
        .kpi-val { font-size: 2.2rem; font-weight: 700; margin: 10px 0 5px 0; font-family: var(--font-mono); }
        .kpi-delta { font-size: 0.8rem; display: flex; align-items: center; gap: 4px; font-weight: 500; }
        .kpi-delta.pos { color: var(--success); }
        .kpi-delta.neg { color: var(--warm); }
        .kpi-delta.neutral { color: var(--text-muted); }

        /* --- 3. ANALISIS IA (INFORME) --- */
        .ai-report-card { grid-column: span 12; border: 1px solid #333; background: linear-gradient(to bottom, #111, #0a0a0a); }
        .ai-header-badge { background: linear-gradient(135deg, #6366f1, #a855f7); color: white; padding: 4px 8px; border-radius: 6px; font-size: 0.7rem; font-weight: 700; }
        .ai-content { 
            font-family: 'Inter', sans-serif; 
            color: #d4d4d8; line-height: 1.7; font-size: 1rem; 
            border-left: 2px solid var(--primary); padding-left: 20px; margin-left: 5px;
            white-space: pre-line; /* Respetar saltos de l√≠nea del LLM */
        }
        .ai-content strong { color: #fff; font-weight: 600; }

        /* --- 4. GR√ÅFICO DIN√ÅMICO (Zonas/Servicios) --- */
        .chart-dynamic { grid-column: span 8; height: 420px; }
        .toggle-group { display: flex; background: var(--bg-elevated); border-radius: 8px; padding: 3px; border: 1px solid var(--border); }
        .toggle-btn { 
            padding: 6px 12px; font-size: 0.75rem; color: var(--text-muted); cursor: pointer; border-radius: 5px; transition: 0.2s; 
        }
        .toggle-btn:hover { color: #fff; }
        .toggle-btn.selected { background: #262626; color: #fff; font-weight: 600; box-shadow: 0 1px 3px rgba(0,0,0,0.5); }

        /* --- 5. FUENTES (Dona) --- */
        .chart-sources { grid-column: span 4; height: 420px; }
        
        /* --- 6. TIMELINE --- */
        .chart-timeline { grid-column: span 12; height: 300px; }

        /* RESPONSIVE */
        @media (max-width: 1024px) { 
            .hero-section { grid-column: span 12; }
            .kpi-mini { grid-column: span 6; }
            .chart-dynamic, .chart-sources { grid-column: span 12; }
            .ytd-stats { display: none; } /* Ocultar stats anuales en movil peque√±o si molesta */
        }

    </style>
</head>
<body>

    <!-- NAV SUPERIOR: TOTALES ANUALES (YTD) -->
    <header class="ytd-header">
        <div class="logo-block">
            <i data-lucide="cpu" size="20" style="color: var(--primary);"></i>
            <span>Provent-Co AI</span>
        </div>
        
        <div class="ytd-stats">
            <div class="ytd-item">
                <span class="ytd-label">Leads Anuales (YTD)</span>
                <span class="ytd-val" id="ytdLeads">0</span>
            </div>
            <div class="ytd-item">
                <span class="ytd-label">Ahorro Acumulado</span>
                <span class="ytd-val" style="color: var(--success);" id="ytdMoney">$0</span>
            </div>
        </div>

        <!-- SELECTOR DE MES -->
        <select id="monthSelector" onchange="renderDashboard(this.value)" style="background: var(--bg-elevated); color: white; border: 1px solid var(--border); padding: 8px 12px; border-radius: 8px;">
            <!-- JS lo llena -->
        </select>
    </header>

    <div class="dashboard-container">

        <!-- 1. HERO CARD (ROI) -->
        <div class="card hero-section">
            <div class="card-header">
                <div class="card-title">AHORRO OPERATIVO NETO</div>
                <div class="pill active"><i data-lucide="zap" size="12"></i> 100% Autom√°tico</div>
            </div>
            <div class="roi-display">
                <div class="roi-currency">$</div>
                <div class="roi-number" id="roiValue">0.00</div>
            </div>
            <div style="display: flex; gap: 15px; margin-top: 15px;">
                <div class="pill"><i data-lucide="clock" size="14"></i> <span id="hoursValue">0</span>hs humanas</div>
                <div class="pill"><i data-lucide="server" size="14"></i> <span id="interactionsValue">0</span> interacciones</div>
            </div>
        </div>

        <!-- 2. KPIs COMPARATIVOS -->
        <div class="card kpi-mini">
            <div class="card-title">Leads Totales</div>
            <div class="kpi-val" id="leadsVal">0</div>
            <div class="kpi-delta" id="leadsDelta">...</div>
        </div>

        <div class="card kpi-mini" style="border-color: rgba(34, 197, 94, 0.2);">
            <div class="card-title" style="color: var(--success);">Calificados</div>
            <div class="kpi-val" style="color: var(--success);" id="qualifiedVal">0</div>
            <div class="kpi-delta" id="qualifiedRate">0% Conv.</div>
        </div>

        <!-- 3. AI REPORT -->
        <div class="card ai-report-card">
            <div class="card-header" style="border-bottom: 1px solid rgba(255,255,255,0.05); padding-bottom: 15px; margin-bottom: 15px;">
                <div class="card-title" style="color: #fff;">
                    <div class="ai-header-badge">AI ANALYST</div>
                    INFORME EJECUTIVO DE RENDIMIENTO
                </div>
            </div>
            <div class="ai-content" id="aiReportText">
                Cargando an√°lisis de inteligencia artificial...
            </div>
        </div>

        <!-- 4. GRAFICO ZONA / SERVICIO -->
        <div class="card chart-dynamic">
            <div class="card-header">
                <div class="card-title">Desglose de Demanda</div>
                <div class="toggle-group">
                    <div class="toggle-btn selected" id="btnZone" onclick="setChartMode('zone')">Por Zona</div>
                    <div class="toggle-btn" id="btnService" onclick="setChartMode('service')">Por Servicio</div>
                </div>
            </div>
            <div style="position: relative; height: 100%; width: 100%;">
                <canvas id="breakdownChart"></canvas>
            </div>
        </div>

        <!-- 5. DONA -->
        <div class="card chart-sources">
            <div class="card-header"><div class="card-title">Canal de Adquisici√≥n</div></div>
            <div style="position: relative; height: 100%; width: 100%; display: flex; align-items: center; justify-content: center;">
                <canvas id="sourceChart"></canvas>
            </div>
        </div>

        <!-- 6. TIMELINE -->
        <div class="card chart-timeline">
            <div class="card-header"><div class="card-title">Evoluci√≥n Diaria (Actividad)</div></div>
            <div style="position: relative; height: 100%; width: 100%;">
                <canvas id="timelineChart"></canvas>
            </div>
        </div>

    </div>

    <!-- LOGICA DE DATOS -->
    <script>
        lucide.createIcons();

        // 1. RECIBIR DATOS DESDE N8N
        // Inyectamos la variable que preparamos arriba
        const HISTORY = [{"email_subject":"üìà Reporte Diciembre: Ahorro de $918.75","email_html":"\\n<!DOCTYPE html>\\n<html>\\n<head>\\n<meta charset=\\"utf-8\\">\\n<meta name=\\"viewport\\" content=\\"width=device-width, initial-scale=1.0\\">\\n<title>Reporte Mensual Provent-Co</title>\\n</head>\\n<body style=\\"margin: 0; padding: 0; background-color: #000000; font-family: \'Helvetica Neue\', Helvetica, Arial, sans-serif; color: #ffffff;\\">\\n\\n  <!-- CONTENEDOR CENTRADO -->\\n  <table width=\\"100%\\" border=\\"0\\" cellspacing=\\"0\\" cellpadding=\\"0\\" style=\\"background-color: #000000; padding: 40px 0;\\">\\n    <tr>\\n      <td align=\\"center\\">\\n        \\n        <!-- TARJETA PRINCIPAL -->\\n        <table width=\\"600\\" border=\\"0\\" cellspacing=\\"0\\" cellpadding=\\"0\\" style=\\"background-color: #0a0a0a; border: 1px solid #222222; border-radius: 16px; overflow: hidden; max-width: 600px; width: 100%;\\">\\n          \\n          <!-- HEADER -->\\n          <tr>\\n            <td style=\\"padding: 30px 40px; border-bottom: 1px solid #222222; text-align: center;\\">\\n              <div style=\\"font-size: 10px; font-weight: 700; letter-spacing: 2px; color: #6366f1; text-transform: uppercase; margin-bottom: 10px;\\">\\n                REPORTES AUTOMATIZADOS\\n              </div>\\n              <h1 style=\\"margin: 0; font-size: 24px; font-weight: 700; color: #ffffff;\\">Provent-Co AI</h1>\\n              <p style=\\"margin: 5px 0 0 0; color: #737373; font-size: 14px;\\">\\n                Resumen de Rendimiento ‚Ä¢ Diciembre 2025\\n              </p>\\n            </td>\\n          </tr>\\n\\n          <!-- HERO ROI (AHORRO) -->\\n          <tr>\\n            <td style=\\"padding: 40px 40px 20px 40px; text-align: center;\\">\\n              <div style=\\"font-size: 12px; color: #a3a3a3; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 5px;\\">\\n                Ahorro Operativo Neto\\n              </div>\\n              <div style=\\"font-size: 48px; font-weight: 700; color: #ffffff; line-height: 1;\\">\\n                $918.75\\n              </div>\\n              <div style=\\"margin-top: 15px;\\">\\n                <span style=\\"background-color: #111111; border: 1px solid #333; color: #22c55e; padding: 5px 12px; border-radius: 20px; font-size: 12px; font-weight: 600;\\">\\n                  ‚ö° 100% Autom√°tico\\n                </span>\\n              </div>\\n            </td>\\n          </tr>\\n\\n          <!-- GRID DE M√âTRICAS (3 COLUMNAS) -->\\n          <tr>\\n            <td style=\\"padding: 20px 40px;\\">\\n              <table width=\\"100%\\" border=\\"0\\" cellspacing=\\"0\\" cellpadding=\\"0\\">\\n                <tr>\\n                  <!-- LEADS -->\\n                  <td width=\\"33%\\" align=\\"center\\" style=\\"border-right: 1px solid #222;\\">\\n                    <div style=\\"font-size: 22px; font-weight: 700; color: #ffffff;\\">151</div>\\n                    <div style=\\"font-size: 10px; text-transform: uppercase; color: #737373; margin-top: 4px;\\">Leads</div>\\n                  </td>\\n                  <!-- CALIFICADOS -->\\n                  <td width=\\"33%\\" align=\\"center\\" style=\\"border-right: 1px solid #222;\\">\\n                    <div style=\\"font-size: 22px; font-weight: 700; color: #22c55e;\\">27</div>\\n                    <div style=\\"font-size: 10px; text-transform: uppercase; color: #737373; margin-top: 4px;\\">Ventas</div>\\n                  </td>\\n                  <!-- HORAS -->\\n                  <td width=\\"33%\\" align=\\"center\\">\\n                    <div style=\\"font-size: 22px; font-weight: 700; color: #6366f1;\\">147h</div>\\n                    <div style=\\"font-size: 10px; text-transform: uppercase; color: #737373; margin-top: 4px;\\">Ahorradas</div>\\n                  </td>\\n                </tr>\\n              </table>\\n            </td>\\n          </tr>\\n\\n          <!-- AN√ÅLISIS IA (CAJA DESTACADA) -->\\n          <tr>\\n            <td style=\\"padding: 20px 40px;\\">\\n              <div style=\\"background-color: #111111; border-left: 3px solid #6366f1; padding: 15px; border-radius: 4px;\\">\\n                <div style=\\"font-size: 10px; font-weight: 700; color: #6366f1; margin-bottom: 5px;\\">AI ANALYST INSIGHT</div>\\n                <p style=\\"margin: 0; font-size: 13px; line-height: 1.6; color: #d4d4d8;\\">\\n                  \\"En diciembre la IA ahorr√≥ $918.75 USD gestionando 151 leads, destac√°ndose Piso Radiante como el servicio m√°s solicitado y Neuqu√©n capital como la zona con mayor demanda, con una tasa de conversi√≥n calificada del 18%.\\"\\n                </p>\\n              </div>\\n            </td>\\n          </tr>\\n\\n          <!-- BOT√ìN CTA -->\\n          <tr>\\n            <td align=\\"center\\" style=\\"padding: 30px 40px 50px 40px;\\">\\n              <a href=\\"https://reportes-proventco.vercel.app/\\" target=\\"_blank\\" style=\\"background-color: #ffffff; color: #000000; text-decoration: none; padding: 14px 32px; border-radius: 8px; font-weight: 700; font-size: 14px; display: inline-block; mso-padding-alt: 0;\\">\\n                Ver Dashboard Interactivo &rarr;\\n              </a>\\n              <p style=\\"margin-top: 20px; font-size: 11px; color: #52525b;\\">\\n                Link seguro: <a href=\\"https://reportes-proventco.vercel.app/\\" style=\\"color: #737373; text-decoration: none;\\">https://reportes-proventco.vercel.app/</a>\\n              </p>\\n            </td>\\n          </tr>\\n\\n        </table>\\n\\n        <!-- FOOTER -->\\n        <table width=\\"600\\" border=\\"0\\" cellspacing=\\"0\\" cellpadding=\\"0\\">\\n          <tr>\\n            <td align=\\"center\\" style=\\"padding: 30px; color: #404040; font-size: 11px;\\">\\n              <p style=\\"margin: 0;\\">Generado autom√°ticamente por el Ecosistema de IA de Provent-Co.</p>\\n              <p style=\\"margin: 5px 0;\\">¬© 2025 Provent-Co. Todos los derechos reservados.</p>\\n            </td>\\n          </tr>\\n        </table>\\n\\n      </td>\\n    </tr>\\n  </table>\\n</body>\\n</html>\\n"}]; 
        
        let currentMonthData = null;
        let chartInstance = null; // Para destruir/recrear el principal
        let viewMode = 'zone'; // 'zone' or 'service'

        // 2. CALCULAR TOTALES YTD (ACUMULADOS ANUALES)
        function calculateYTD() {
            // Asumimos a√±o actual del √∫ltimo reporte
            if(HISTORY.length === 0) return;
            const currentYear = HISTORY[HISTORY.length-1].year;
            
            const reportsThisYear = HISTORY.filter(h => h.year === currentYear);
            
            const totalLeads = reportsThisYear.reduce((acc, curr) => acc + (curr.stats_data.kpis.total_leads || 0), 0);
            const totalMoney = reportsThisYear.reduce((acc, curr) => acc + parseFloat(curr.stats_data.roi.money_saved_usd || 0), 0);

            document.getElementById('ytdLeads').innerText = totalLeads;
            document.getElementById('ytdMoney').innerText = '$' + totalMoney.toLocaleString('en-US', {minimumFractionDigits: 0});
        }

        // 3. INICIALIZAR SELECTOR
        const selector = document.getElementById('monthSelector');
        // Iteramos INVERSO para tener el m√°s reciente arriba
        [...HISTORY].reverse().forEach((h, index) => {
            // El √≠ndice original en HISTORY es lo que necesitamos (length - 1 - index)
            const realIndex = HISTORY.indexOf(h);
            const opt = document.createElement('option');
            opt.value = realIndex;
            opt.text = h.stats_data.meta.month_name + ' ' + h.year;
            selector.appendChild(opt);
        });

        // 4. RENDER DASHBOARD (Funci√≥n Maestra)
        function renderDashboard(index) {
            const report = HISTORY[index];
            currentMonthData = report.stats_data; // Shortcut al JSON
            
            // --- A. TEXTOS Y KPIS ---
            // Animar n√∫meros simple
            document.getElementById('roiValue').innerText = currentMonthData.roi.money_saved_usd;
            document.getElementById('hoursValue').innerText = currentMonthData.roi.hours_saved;
            document.getElementById('interactionsValue').innerText = currentMonthData.kpis.interactions;

            document.getElementById('leadsVal').innerText = currentMonthData.kpis.total_leads;
            document.getElementById('qualifiedVal').innerText = currentMonthData.kpis.qualified_leads;
            
            // Texto IA (Con formato bold si lo hubiera)
            document.getElementById('aiReportText').innerHTML = (report.ai_analysis || "No hay an√°lisis disponible.").replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');

            // --- B. COMPARATIVA MES ANTERIOR ---
            if(index > 0) {
                const prevReport = HISTORY[index - 1].stats_data;
                const prevLeads = prevReport.kpis.total_leads || 0;
                const currLeads = currentMonthData.kpis.total_leads || 0;
                
                let diff = 0;
                let text = "vs inicio";
                
                if (prevLeads > 0) {
                    diff = ((currLeads - prevLeads) / prevLeads) * 100;
                    text = diff > 0 ? `+${diff.toFixed(1)}% vs mes ant.` : `${diff.toFixed(1)}% vs mes ant.`;
                }

                const el = document.getElementById('leadsDelta');
                el.innerText = text;
                el.className = 'kpi-delta ' + (diff >= 0 ? 'pos' : 'neg');
            } else {
                document.getElementById('leadsDelta').innerText = "Inicio de ciclo";
                document.getElementById('leadsDelta').className = 'kpi-delta neutral';
            }

            // Tasa Conversion
            const rate = currentMonthData.kpis.total_leads > 0 
                ? ((currentMonthData.kpis.qualified_leads / currentMonthData.kpis.total_leads)*100).toFixed(1) 
                : 0;
            document.getElementById('qualifiedRate').innerText = rate + "% Conversi√≥n";

            // --- C. RENDERIZAR GR√ÅFICOS ---
            renderMainChart();
            renderSourceChart();
            renderTimelineChart();
        }

        // --- CHART 1: ZONA vs SERVICIO (Swappable) ---
        function setChartMode(mode) {
            viewMode = mode;
            // Update buttons
            document.getElementById('btnZone').className = mode === 'zone' ? 'toggle-btn selected' : 'toggle-btn';
            document.getElementById('btnService').className = mode === 'service' ? 'toggle-btn selected' : 'toggle-btn';
            renderMainChart();
        }

        function renderMainChart() {
            // Destruir si existe para evitar glitch
            if(chartInstance) chartInstance.destroy();
            
            const ctx = document.getElementById('breakdownChart').getContext('2d');
            const data = currentMonthData.charts; // { locations: {labels, data}, services: {labels, data} }

            // Elegir datos seg√∫n modo
            const labels = viewMode === 'zone' ? data.locations.labels : data.services.labels;
            const values = viewMode === 'zone' ? data.locations.data : data.services.data;
            const color = viewMode === 'zone' ? '#6366f1' : '#f59e0b';
            const labelTitle = viewMode === 'zone' ? 'Leads por Zona' : 'Leads por Servicio';

            chartInstance = new Chart(ctx, {
                type: 'bar', // Barra Horizontal es mejor para leer nombres largos
                data: {
                    labels: labels,
                    datasets: [{
                        label: labelTitle,
                        data: values,
                        backgroundColor: color,
                        borderRadius: 6,
                        barPercentage: 0.6
                    }]
                },
                options: {
                    indexAxis: 'y', // SIEMPRE HORIZONTAL para leer bien nombres como "Piso Radiante"
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: { grid: { color: '#333', borderDash: [4,4] } },
                        y: { grid: { display: false } }
                    },
                    plugins: { legend: { display: false } }
                }
            });
        }

        // --- CHART 2: SOURCES (Dona) ---
        function renderSourceChart() {
            // Destruir por ID si hace falta (simple way)
            const chartStatus = Chart.getChart("sourceChart"); 
            if (chartStatus != undefined) chartStatus.destroy();

            const ctx = document.getElementById('sourceChart');
            const sData = currentMonthData.charts.sources;
            
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: sData.labels,
                    datasets: [{
                        data: sData.data,
                        backgroundColor: ['#6366f1', '#10b981', '#f59e0b', '#ec4899', '#3b82f6'],
                        borderWidth: 0,
                        hoverOffset: 15
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '70%',
                    plugins: { 
                        legend: { position: 'bottom', labels: { color: '#a3a3a3', usePointStyle: true } } 
                    }
                }
            });
        }

        // --- CHART 3: TIMELINE (Line) ---
        function renderTimelineChart() {
            const chartStatus = Chart.getChart("timelineChart"); 
            if (chartStatus != undefined) chartStatus.destroy();

            const ctx = document.getElementById('timelineChart').getContext('2d');
            const tData = currentMonthData.charts.timeline;

            // Gradiente
            const grad = ctx.createLinearGradient(0,0,0,400);
            grad.addColorStop(0, 'rgba(99, 102, 241, 0.5)');
            grad.addColorStop(1, 'rgba(99, 102, 241, 0.0)');

            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: tData.labels.map(d => 'D√≠a '+d), // Formatear labels
                    datasets: [{
                        label: 'Leads Diarios',
                        data: tData.data,
                        borderColor: '#6366f1',
                        backgroundColor: grad,
                        tension: 0.4,
                        fill: true,
                        pointRadius: 0,
                        pointHoverRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: { beginAtZero: true, grid: { color: '#222' } },
                        x: { grid: { display: false }, ticks: { color: '#555' } }
                    },
                    plugins: { legend: { display: false } }
                }
            });
        }

        // GLOBALS CHART CONFIG
        Chart.defaults.color = '#737373';
        Chart.defaults.borderColor = '#222';
        Chart.defaults.font.family = "'Plus Jakarta Sans', sans-serif";

        // INICIAR
        calculateYTD();
        // Cargar el ultimo reporte disponible
        if(HISTORY.length > 0) {
            renderDashboard(HISTORY.length - 1);
            // Preseleccionar en dropdown
            selector.value = HISTORY.length - 1;
        } else {
            document.body.innerHTML = "<h1 style='color:white; text-align:center; margin-top:50px;'>No hay datos hist√≥ricos a√∫n.</h1>";
        }

    </script>
</body>
</html>
